<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LaTeX Онлайн-редактор</title>
  
  <!-- CodeMirror для редактора кода -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/default.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/stex/stex.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/matchbrackets.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/edit/closebrackets.min.js"></script>
  
  <!-- MathJax для формул в подсказках и предпросмотре -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.min.js"></script>
  
  <!-- Подключаем наши стили и скрипты -->
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/drawing-styles.css">
  
</head>
<body>
  <header>
    <div style="display: flex; align-items: center;">
      <h1>LaTeX Онлайн-редактор</h1>
      <span id="autosave-indicator" class="autosave-indicator">Автосохранение...</span>
    </div>
    <div class="header-buttons">
      <button id="compile-btn">Компилировать</button>
      <button id="settings-btn">Настройки</button>
      <button id="files-btn">Файлы</button>
      <button id="smart-macros-btn">Умные макросы</button>
      <button id="help-btn">Справка</button>
    </div>
  </header>
  
  <main>
    <div class="editor-pane">
      <div class="toolbar">
        <button data-insert="\section{}">Раздел</button>
        <button data-insert="\subsection{}">Подраздел</button>
        <button data-insert="\begin{equation}\n\n\end{equation}">Уравнение</button>
        <button data-insert="\begin{figure}\n\centering\n\includegraphics[width=0.8\textwidth]{}\n\caption{}\n\label{fig:}\n\end{figure}">Рисунок</button>
        <button id="drawing-btn" title="Редактор рисования">Нарисовать</button>
        <button data-insert="\begin{table}\n\centering\n\begin{tabular}{|c|c|}\n\hline\n & \\\\ \n\hline\n & \\\\ \n\hline\n\end{tabular}\n\caption{}\n\label{tab:}\n\end{table}">Таблица</button>
        <button data-insert="\begin{itemize}\n\item \n\item \n\end{itemize}">Список</button>
        <button data-insert="\begin{enumerate}\n\item \n\item \n\end{enumerate}">Нумер. список</button>
        <button data-insert="$$">Формула</button>
      </div>
      <div class="editor-container">
        <textarea id="editor">
\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage[T2A]{fontenc}
\usepackage[russian]{babel}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{hyperref}

\title{Название документа}
\author{Ваше имя}
\date{\today}

\begin{document}

\maketitle

\section{Введение}
Напишите здесь ваш текст...

\section{Математические формулы}
Пример встроенной формулы: $E = mc^2$

Пример выделенной формулы:
\begin{equation}
F(x) = \int_{a}^{b} f(x) \, dx
\end{equation}

\section{Списки}
\begin{itemize}
  \item Первый пункт
  \item Второй пункт
  \item Третий пункт
\end{itemize}

\end{document}
        </textarea>
        <div class="loading-overlay">
          <div class="spinner"></div>
        </div>
      </div>
      <div class="status-bar">
        <div>
          <span id="status">Готово</span>
        </div>
        <div style="display: flex; align-items: center;">
          <span id="current-file">document1.tex</span>
          <span id="cursor-position" style="margin-left: 15px;">Строка: 1, Столбец: 1</span>
        </div>
      </div>
    </div>
    
    <div class="preview-pane">
      <div class="toolbar">
        <button id="zoom-in">Увеличить</button>
        <button id="zoom-out">Уменьшить</button>
        <button id="download-pdf">Скачать PDF</button>
      </div>
      <div class="preview-container">
        <div id="pdf-preview">
          <!-- Здесь будет предпросмотр PDF -->
        </div>
      </div>
    </div>
  </main>
  
  <!-- Модальное окно для умных макросов -->
  <div id="smart-macros-modal" class="modal">
    <div class="modal-content" style="width: 70%; max-width: 800px;">
      <span class="close">&times;</span>
      <h2>Умные макросы</h2>
      
      <p>Умные макросы автоматически преобразуют текстовые шаблоны в LaTeX команды при нажатии Tab.</p>
      
      <!-- Вкладки для категорий -->
      <div class="macro-tabs">
        <button class="macro-tab-btn active" data-tab="user-macros">Мои макросы</button>
        <button class="macro-tab-btn" data-tab="math-macros">Математика</button>
        <button class="macro-tab-btn" data-tab="structure-macros">Структура</button>
        <button class="macro-tab-btn" data-tab="text-macros">Форматирование</button>
        <button class="macro-tab-btn" data-tab="env-macros">Окружения</button>
        <button class="macro-tab-btn" data-tab="create-macro">Создать</button>
      </div>
      
      <!-- Пользовательские макросы -->
      <div class="macro-tab-content" id="user-macros">
        <h3>Ваши пользовательские макросы</h3>
        <div id="smart-macros-list" class="macros-list">
          <!-- Здесь будет список пользовательских макросов -->
        </div>
        <p class="empty-list-message" id="empty-user-macros">У вас пока нет пользовательских макросов. Перейдите на вкладку "Создать" чтобы добавить макрос.</p>
      </div>
      
      <!-- Математические макросы -->
      <div class="macro-tab-content" id="math-macros" style="display: none;">
        <h3>Математические макросы</h3>
        <div class="macros-list predefined-macros">
          <div class="macro-item">
            <div class="macro-info">
              <div class="macro-pattern">a/b</div>
              <div class="macro-arrow">→</div>
              <div class="macro-result">\frac{a}{b}</div>
            </div>
            <button class="add-predefined-macro" data-pattern="([^\\s/]+)/([^\\s/]+)" data-template="\frac{$1}{$2}">Добавить</button>
          </div>
          <div class="macro-item">
            <div class="macro-info">
              <div class="macro-pattern">a^b</div>
              <div class="macro-arrow">→</div>
              <div class="macro-result">a^{b}</div>
            </div>
            <button class="add-predefined-macro" data-pattern="([A-Za-z0-9]+)\^([A-Za-z0-9]+)" data-template="$1^{$2}">Добавить</button>
          </div>
          <!-- Остальные математические макросы -->
          <!-- ... -->
        </div>
      </div>
      
      <!-- Структурные макросы -->
      <div class="macro-tab-content" id="structure-macros" style="display: none;">
        <h3>Структурные макросы</h3>
        <div class="macros-list predefined-macros">
          <!-- Структурные макросы -->
          <!-- ... -->
        </div>
      </div>
      
      <!-- Форматирование текста -->
      <div class="macro-tab-content" id="text-macros" style="display: none;">
        <h3>Макросы форматирования текста</h3>
        <div class="macros-list predefined-macros">
          <!-- Макросы форматирования -->
          <!-- ... -->
        </div>
      </div>
      
      <!-- Окружения -->
      <div class="macro-tab-content" id="env-macros" style="display: none;">
        <h3>Макросы окружений</h3>
        <div class="macros-list predefined-macros">
          <!-- Макросы окружений -->
          <!-- ... -->
        </div>
      </div>
      
      <!-- Создание пользовательского макроса -->
      <div class="macro-tab-content" id="create-macro" style="display: none;">
        <h3>Создать свой макрос</h3>
        <div class="form-group">
          <label for="smart-macro-pattern">Шаблон поиска:</label>
          <input type="text" id="smart-macro-pattern" placeholder="Например: ([^\\s/]+)/([^\\s/]+)">
          <p class="form-hint">Используйте регулярные выражения для определения шаблона.</p>
        </div>
        
        <div class="form-group">
          <label for="smart-macro-template">Шаблон замены:</label>
          <input type="text" id="smart-macro-template" placeholder="Например: \frac{$1}{$2}">
          <p class="form-hint">$1, $2, и т.д. будут заменены на соответствующие части шаблона.</p>
        </div>
        
        <div class="smart-macro-preview">
          <span class="smart-macro-preview-before" id="smart-macro-before">a1/b1</span>
          <span class="smart-macro-preview-arrow">→</span>
          <span class="smart-macro-preview-after" id="smart-macro-after">\frac{a1}{b1}</span>
        </div>
        
        <button id="add-smart-macro-btn" class="primary-btn">Добавить умный макрос</button>
      </div>
    </div>
  </div>
  
  <!-- Модальное окно для настроек -->
  <div id="settings-modal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Настройки</h2>
      
      <div class="settings-group">
        <h3>Компиляция и сохранение</h3>
        
        <div class="settings-row">
          <label class="switch">
            <input type="checkbox" id="autocompile-toggle">
            <span class="slider"></span>
          </label>
          <label for="autocompile-toggle">Автоматическая компиляция</label>
        </div>
        
        <div class="settings-row">
          <label for="autocompile-delay">Задержка автокомпиляции:</label>
          <input type="number" id="autocompile-delay" min="1" max="10" value="2" style="width: 60px; margin-left: 10px;"> сек.
        </div>
        
        <div class="settings-row">
          <label class="switch">
            <input type="checkbox" id="autosave-toggle" checked>
            <span class="slider"></span>
          </label>
          <label for="autosave-toggle">Автосохранение</label>
        </div>
        
        <div class="settings-row">
          <label for="autosave-interval">Интервал автосохранения:</label>
          <input type="number" id="autosave-interval" min="1" max="30" value="3" style="width: 60px; margin-left: 10px;"> сек.
        </div>
      </div>
      
      <div class="settings-group">
        <h3>Интерфейс</h3>
        
        <div class="settings-row">
          <label for="font-size">Размер шрифта в редакторе:</label>
          <select id="font-size" style="width: 100px; margin-left: 10px;">
            <option value="12">12px</option>
            <option value="14" selected>14px</option>
            <option value="16">16px</option>
            <option value="18">18px</option>
          </select>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Модальное окно для файлов -->
  <div id="files-modal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Управление файлами</h2>
      
      <div class="form-group">
        <label for="new-file-name">Новый файл:</label>
        <div style="display: flex; gap: 10px;">
          <input type="text" id="new-file-name" placeholder="Имя файла (без расширения)">
          <button id="create-file-btn">Создать</button>
        </div>
      </div>
      
      <h3 style="margin-top: 15px;">Ваши файлы</h3>
      <div id="file-list" class="file-list">
        <!-- Здесь будет список файлов -->
      </div>
    </div>
  </div>

  <!-- Подключаем JS-модули -->
  <script src="css/js/editor.js"></script>
  <script src="css/js/file-manager.js"></script>
  <script src="css/js/smart-macros.js"></script>
  <script src="css/js/settings.js"></script>
  <script src="css/js/preview.js"></script>
  <script src="css/js/drawing-canvas.js"></script>
  <script src="css/js/drawing-tools.js"></script>
  <script src="css/js/drawing-tikz-converter.js"></script>
  <script src="css/js/drawing-ui.js"></script>
  <script src="css/js/drawing-editor.js"></script>
  <script src="css/js/main.js"></script>
</body>
</html>
